/* Mobile-First Dashboard Optimizations */

/* Safe Area Support for Notch/Home Indicator */
@supports (padding: env(safe-area-inset-top)) {
  .mobile-safe-top {
    padding-top: env(safe-area-inset-top);
  }
  
  .mobile-safe-bottom {
    padding-bottom: env(safe-area-inset-bottom);
  }
  
  .mobile-safe-left {
    padding-left: env(safe-area-inset-left);
  }
  
  .mobile-safe-right {
    padding-right: env(safe-area-inset-right);
  }
}

/* Touch Target Sizing (iOS 44x44px, Android 48x48px) */
.touch-target {
  min-width: 44px;
  min-height: 44px;
  min-touch-action: manipulation;
}

.touch-target-large {
  min-width: 48px;
  min-height: 48px;
  min-touch-action: manipulation;
}

/* Better Touch Handling */
.touch-manipulation {
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  user-select: none;
  -webkit-user-select: none;
}

/* Prevent Text Selection on Touch */
.no-select {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}

/* Smooth Scrolling */
.mobile-scroll {
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
  overscroll-behavior-y: contain; /* Prevent bounce on iOS */
}

/* Mobile-Specific Typography */
@media (max-width: 768px) {
  .mobile-text-base {
    font-size: clamp(16px, 4vw, 18px);
    line-height: 1.5;
  }
  
  .mobile-text-lg {
    font-size: clamp(18px, 5vw, 24px);
    line-height: 1.4;
  }
  
  .mobile-text-xl {
    font-size: clamp(24px, 6vw, 32px);
    line-height: 1.3;
  }
  
  /* Minimum readable text size */
  body, p, span, div {
    font-size: min(16px, 4vw);
  }
}

/* Mobile Button Optimizations */
@media (max-width: 768px) {
  .mobile-button {
    min-height: 48px; /* Android standard */
    padding: 12px 20px;
    font-size: 16px;
    border-radius: 12px;
    touch-action: manipulation;
  }
  
  .mobile-button-icon {
    width: 48px;
    height: 48px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
}

/* Grid Layout Adjustments for Mobile */
@media (max-width: 768px) {
  .widget-container {
    padding: 8px;
    gap: 8px;
  }
  
  .widget-card {
    width: 100%;
    margin: 0;
    border-radius: 16px;
  }
}

/* Pull-to-Refresh Indicator */
.pull-to-refresh {
  position: relative;
  overflow: hidden;
}

.pull-to-refresh::before {
  content: '';
  position: absolute;
  top: -60px;
  left: 0;
  right: 0;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(to bottom, rgba(0,0,0,0.05), transparent);
  transition: transform 0.3s ease;
}

.pull-to-refresh.refreshing::before {
  transform: translateY(60px);
}

/* Mobile Chart Optimizations */
@media (max-width: 768px) {
  .chart-container canvas,
  .chart-container svg {
    max-height: 300px;
    touch-action: pan-x pan-y; /* Allow chart pan/zoom */
  }
  
  .chart-tooltip {
    font-size: 14px;
    padding: 8px 12px;
    pointer-events: none;
  }
}

/* Loading States for Mobile */
@media (max-width: 768px) {
  .mobile-loading-spinner {
    width: 32px;
    height: 32px;
    border-width: 3px;
  }
  
  .mobile-skeleton {
    background: linear-gradient(
      90deg,
      hsl(var(--muted)) 0%,
      hsl(var(--muted-foreground) / 0.1) 50%,
      hsl(var(--muted)) 100%
    );
    background-size: 200% 100%;
    animation: skeleton-loading 1.5s ease-in-out infinite;
  }
}

@keyframes skeleton-loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* Mobile Dialog/Modal Optimizations */
@media (max-width: 768px) {
  .mobile-dialog {
    max-width: 100%;
    max-height: 100vh;
    margin: 0;
    border-radius: 0;
    padding: env(safe-area-inset-top) 16px env(safe-area-inset-bottom) 16px;
  }
  
  .mobile-dialog-content {
    max-height: calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom) - 32px);
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
}

/* Hamburger Menu (for mobile navigation) */
@media (max-width: 768px) {
  .mobile-menu-button {
    position: fixed;
    top: env(safe-area-inset-top);
    left: 16px;
    z-index: 1000;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: hsl(var(--background));
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  }
  
  .mobile-menu {
    position: fixed;
    inset: 0;
    background: hsl(var(--background));
    z-index: 999;
    padding-top: calc(48px + env(safe-area-inset-top));
    transform: translateX(-100%);
    transition: transform 0.3s ease;
  }
  
  .mobile-menu.open {
    transform: translateX(0);
  }
}

/* Bottom Navigation for Key Actions */
@media (max-width: 768px) {
  .mobile-bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: calc(56px + env(safe-area-inset-bottom));
    padding-bottom: env(safe-area-inset-bottom);
    background: hsl(var(--background));
    border-top: 1px solid hsl(var(--border));
    display: flex;
    justify-content: space-around;
    align-items: center;
    z-index: 1000;
  }
  
  .mobile-nav-item {
    flex: 1;
    height: 56px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    color: hsl(var(--muted-foreground));
    touch-action: manipulation;
  }
  
  .mobile-nav-item.active {
    color: hsl(var(--primary));
  }
}

/* Orientation Change Handling */
@media (orientation: landscape) and (max-height: 500px) {
  .landscape-compact {
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
  }
}

/* Dark Mode Adjustments for Mobile */
@media (max-width: 768px) and (prefers-color-scheme: dark) {
  .widget-card {
    background: hsl(var(--card));
    border-color: hsl(var(--border));
  }
  
  .mobile-bottom-nav {
    background: hsl(var(--background));
    border-top-color: hsl(var(--border));
  }
}

/* Performance Optimizations */
@media (max-width: 768px) {
  /* Reduce animations on mobile for better performance */
  .mobile-performance-mode * {
    animation-duration: 0.2s !important;
    transition-duration: 0.2s !important;
  }
  
  /* Hardware acceleration */
  .gpu-accelerated {
    transform: translateZ(0);
    will-change: transform;
    backface-visibility: hidden;
  }
}

/* Focus States for Accessibility */
@media (max-width: 768px) {
  .mobile-button:focus-visible,
  .mobile-nav-item:focus-visible {
    outline: 2px solid hsl(var(--primary));
    outline-offset: 2px;
  }
}

/* Swipe Gesture Hints */
.swipe-hint {
  position: relative;
  overflow: hidden;
}

.swipe-hint::after {
  content: '‚Üê Swipe to remove';
  position: absolute;
  right: 0;
  top: 50%;
  transform: translateY(-50%);
  background: hsl(var(--destructive));
  color: white;
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 12px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.swipe-hint.swiping::after {
  opacity: 1;
}

/* Responsive Iframes (for embedded widgets) */
@media (max-width: 768px) {
  .responsive-iframe {
    width: 100%;
    height: 0;
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
    position: relative;
  }
  
  .responsive-iframe iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }
}
