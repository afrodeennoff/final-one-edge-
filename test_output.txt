
> quntedge@0.3 test:payment
> vitest --config vitest.payment.config.ts --run lib/__tests__/payment-flows.test.ts


 RUN  v2.1.9 /Users/timon/Downloads/lassttry-edge--main

stdout | lib/__tests__/payment-flows.test.ts
[2026-01-31T22:37:56.689Z] WARN: [SecurityManager] Encryption key not configured 

stderr | lib/__tests__/payment-flows.test.ts
DATABASE_URL not configured, some tests might fail if they require DB access.

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Checkout Session Creation > should create a checkout session for monthly plan
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Checkout Session Creation > should create a checkout session for monthly plan
[2026-01-31T22:37:57.685Z] ERROR: [PaymentService] Failed to create checkout session {"error":"401 {\"error\":{\"type\":\"unauthorized\",\"message\":\"Authentication failed\"}}","options":{"planKey":"monthly","userId":"test-user-1","email":"test@example.com"}}

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Checkout Session Creation > should create a checkout session with referral code
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Checkout Session Creation > should create a checkout session with referral code
[2026-01-31T22:37:58.701Z] ERROR: [PaymentService] Failed to create checkout session {"error":"401 {\"error\":{\"type\":\"unauthorized\",\"message\":\"Authentication failed\"}}","options":{"planKey":"yearly","userId":"test-user-2","email":"test@example.com","referralCode":"REFERRAL123"}}

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Checkout Session Creation > should fail with invalid plan
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Promotion Code Validation > should validate a valid promotion code
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Promotion Code Validation > should validate a valid promotion code
prisma:error 
Invalid `prisma.promotion.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:51:32

  48 
  49 describe('Promotion Code Validation', () => {
  50   it('should validate a valid promotion code', async () => {
â†’ 51     await prisma.promotion.create(


stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Promotion Code Validation > should reject expired promotion code
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Promotion Code Validation > should reject expired promotion code
prisma:error 
Invalid `prisma.promotion.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:72:32

  69 })
  70 
  71 it('should reject expired promotion code', async () => {
â†’ 72   await prisma.promotion.create(


stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Promotion Code Validation > should reject inactive promotion code
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Promotion Code Validation > should reject inactive promotion code
prisma:error 
Invalid `prisma.promotion.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:92:32

  89 })
  90 
  91 it('should reject inactive promotion code', async () => {
â†’ 92   await prisma.promotion.create(


stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Transaction Recording > should record a successful transaction
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Transaction Recording > should record a successful transaction
prisma:error 
Invalid `prisma.paymentTransaction.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/server/payment-service.ts:187:59

  184   metadata?: Record<string, any>
  185 }): Promise<{ success: boolean; transactionId?: string; error?: string }> {
  186   try {
â†’ 187     const transaction = await prisma.paymentTransaction.create(

[2026-01-31T22:37:58.846Z] ERROR: [PaymentService] Failed to record transaction {"error":{"code":"ECONNREFUSED","meta":{"modelName":"PaymentTransaction"},"clientVersion":"7.3.0","name":"PrismaClientKnownRequestError"},"data":{"userId":"test-user","email":"test@example.com","whopTransactionId":"txn_test_123","amount":2900,"currency":"USD","type":"SUBSCRIPTION","status":"COMPLETED"}}

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Transaction Recording > should not record duplicate transactions
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Transaction Recording > should not record duplicate transactions
prisma:error 
Invalid `prisma.paymentTransaction.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/server/payment-service.ts:187:59

  184   metadata?: Record<string, any>
  185 }): Promise<{ success: boolean; transactionId?: string; error?: string }> {
  186   try {
â†’ 187     const transaction = await prisma.paymentTransaction.create(

[2026-01-31T22:37:58.850Z] ERROR: [PaymentService] Failed to record transaction {"error":{"code":"ECONNREFUSED","meta":{"modelName":"PaymentTransaction"},"clientVersion":"7.3.0","name":"PrismaClientKnownRequestError"},"data":{"userId":"test-user","email":"test@example.com","whopTransactionId":"txn_test_123","amount":2900,"currency":"USD","type":"SUBSCRIPTION","status":"COMPLETED"}}

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Transaction Recording > should not record duplicate transactions
prisma:error 
Invalid `prisma.paymentTransaction.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/server/payment-service.ts:187:59

  184   metadata?: Record<string, any>
  185 }): Promise<{ success: boolean; transactionId?: string; error?: string }> {
  186   try {
â†’ 187     const transaction = await prisma.paymentTransaction.create(

[2026-01-31T22:37:58.852Z] ERROR: [PaymentService] Failed to record transaction {"error":{"code":"ECONNREFUSED","meta":{"modelName":"PaymentTransaction"},"clientVersion":"7.3.0","name":"PrismaClientKnownRequestError"},"data":{"userId":"test-user","email":"test@example.com","whopTransactionId":"txn_test_123","amount":2900,"currency":"USD","type":"SUBSCRIPTION","status":"COMPLETED"}}

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Invoice Creation > should create an invoice
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Invoice Creation > should create an invoice
prisma:error 
Invalid `prisma.invoice.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/server/payment-service.ts:227:44

  224   hostedInvoiceUrl?: string
  225 }): Promise<{ success: boolean; invoiceId?: string; error?: string }> {
  226   try {
â†’ 227     const invoice = await prisma.invoice.create(

[2026-01-31T22:37:58.856Z] ERROR: [PaymentService] Failed to create invoice {"error":{"code":"ECONNREFUSED","meta":{"modelName":"Invoice"},"clientVersion":"7.3.0","name":"PrismaClientKnownRequestError"},"data":{"userId":"test-user","email":"test@example.com","whopInvoiceId":"inv_test_123","amountDue":2900,"currency":"USD","dueDate":"2026-02-07T22:37:58.853Z"}}

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Refund Processing > should process a full refund
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Refund Processing > should process a full refund
prisma:error 
Invalid `prisma.paymentTransaction.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:163:53

  160 
  161 describe('Refund Processing', () => {
  162   it('should process a full refund', async () => {
â†’ 163     const txn = await prisma.paymentTransaction.create(


stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Refund Processing > should process a partial refund
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Refund Processing > should process a partial refund
prisma:error 
Invalid `prisma.paymentTransaction.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:186:53

  183 })
  184 
  185 it('should process a partial refund', async () => {
â†’ 186   const txn = await prisma.paymentTransaction.create(


stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Refund Processing > should fail to refund non-completed transaction
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Refund Processing > should fail to refund non-completed transaction
prisma:error 
Invalid `prisma.paymentTransaction.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:208:53

  205 })
  206 
  207 it('should fail to refund non-completed transaction', async () => {
â†’ 208   const txn = await prisma.paymentTransaction.create(


stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Creation > should create a monthly subscription
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Creation > should create a monthly subscription
prisma:error 
Invalid `prisma.subscription.findUnique()` invocation in
/Users/timon/Downloads/lassttry-edge--main/server/subscription-manager.ts:53:62

  50   metadata?: Record<string, any>
  51 }): Promise<{ success: boolean; subscriptionId?: string; error?: string }> {
  52   try {
â†’ 53     const existingSubscription = await prisma.subscription.findUnique(

[2026-01-31T22:37:58.884Z] ERROR: [SubscriptionManager] Failed to create subscription {"error":{"code":"ECONNREFUSED","meta":{"modelName":"Subscription"},"clientVersion":"7.3.0","name":"PrismaClientKnownRequestError"},"data":{"userId":"test-user-monthly","email":"test@example.com","plan":"monthly","interval":"month"}}

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Creation > should create a trial subscription
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Creation > should create a trial subscription
prisma:error 
Invalid `prisma.subscription.findUnique()` invocation in
/Users/timon/Downloads/lassttry-edge--main/server/subscription-manager.ts:53:62

  50   metadata?: Record<string, any>
  51 }): Promise<{ success: boolean; subscriptionId?: string; error?: string }> {
  52   try {
â†’ 53     const existingSubscription = await prisma.subscription.findUnique(

[2026-01-31T22:37:58.890Z] ERROR: [SubscriptionManager] Failed to create subscription {"error":{"code":"ECONNREFUSED","meta":{"modelName":"Subscription"},"clientVersion":"7.3.0","name":"PrismaClientKnownRequestError"},"data":{"userId":"test-user-trial","email":"test@example.com","plan":"monthly","interval":"month","trial":true}}

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Creation > should create a lifetime subscription
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Creation > should create a lifetime subscription
prisma:error 
Invalid `prisma.subscription.findUnique()` invocation in
/Users/timon/Downloads/lassttry-edge--main/server/subscription-manager.ts:53:62

  50   metadata?: Record<string, any>
  51 }): Promise<{ success: boolean; subscriptionId?: string; error?: string }> {
  52   try {
â†’ 53     const existingSubscription = await prisma.subscription.findUnique(

[2026-01-31T22:37:58.894Z] ERROR: [SubscriptionManager] Failed to create subscription {"error":{"code":"ECONNREFUSED","meta":{"modelName":"Subscription"},"clientVersion":"7.3.0","name":"PrismaClientKnownRequestError"},"data":{"userId":"test-user-lifetime","email":"test@example.com","plan":"lifetime","interval":"lifetime"}}

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Updates > should upgrade subscription plan
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Updates > should upgrade subscription plan
prisma:error 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:270:47

  267 
  268 describe('Subscription Updates', () => {
  269   it('should upgrade subscription plan', async () => {
â†’ 270     const sub = await prisma.subscription.create(


stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Updates > should downgrade subscription plan
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Updates > should downgrade subscription plan
prisma:error 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:291:47

  288 })
  289 
  290 it('should downgrade subscription plan', async () => {
â†’ 291   const sub = await prisma.subscription.create(


stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Cancellation > should cancel subscription immediately
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Cancellation > should cancel subscription immediately
prisma:error 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:314:47

  311 
  312 describe('Subscription Cancellation', () => {
  313   it('should cancel subscription immediately', async () => {
â†’ 314     const sub = await prisma.subscription.create(


stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Cancellation > should schedule subscription cancellation
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Cancellation > should schedule subscription cancellation
prisma:error 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:335:47

  332 })
  333 
  334 it('should schedule subscription cancellation', async () => {
â†’ 335   const sub = await prisma.subscription.create(


stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Payment Failure Handling > should mark subscription as past due on first failure
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Payment Failure Handling > should mark subscription as past due on first failure
prisma:error 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:358:47

  355 
  356 describe('Payment Failure Handling', () => {
  357   it('should mark subscription as past due on first failure', async () => {
â†’ 358     const sub = await prisma.subscription.create(


stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Payment Failure Handling > should cancel subscription after 3 failures
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Payment Failure Handling > should cancel subscription after 3 failures
prisma:error 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:381:47

  378 })
  379 
  380 it('should cancel subscription after 3 failures', async () => {
â†’ 381   const sub = await prisma.subscription.create(


stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Payment Success Handling > should update subscription on successful payment
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Payment Success Handling > should update subscription on successful payment
prisma:error 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:406:47

  403 
  404 describe('Payment Success Handling', () => {
  405   it('should update subscription on successful payment', async () => {
â†’ 406     const sub = await prisma.subscription.create(


stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Grace Period Management > should start grace period for expired subscriptions
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Grace Period Management > should start grace period for expired subscriptions
prisma:error 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:432:35

  429 describe('Grace Period Management', () => {
  430   it('should start grace period for expired subscriptions', async () => {
  431     const pastDate = new Date(Date.now() - 24 * 60 * 60 * 1000)
â†’ 432     await prisma.subscription.create(


stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Membership Events > should process membership.activated event
[2026-01-31T22:37:58.926Z] INFO: [WebhookService] Processing webhook event {"eventType":"membership.activated","eventId":"evt_test_activated"}

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Membership Events > should process membership.activated event
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Membership Events > should process membership.activated event
prisma:error 
Invalid `prisma.processedWebhook.findUnique()` invocation in
/Users/timon/Downloads/lassttry-edge--main/server/webhook-service.ts:93:54

  90 })
  91 
  92 // Check for already processed webhook (Idempotency)
â†’ 93 const existing = await prisma.processedWebhook.findUnique(

[2026-01-31T22:37:58.930Z] ERROR: [WebhookService] Event processing failed {"eventType":"membership.activated","eventId":"evt_test_activated","error":"\nInvalid `prisma.processedWebhook.findUnique()` invocation in\n/Users/timon/Downloads/lassttry-edge--main/server/webhook-service.ts:93:54\n\n  90 })\n  91 \n  92 // Check for already processed webhook (Idempotency)\nâ†’ 93 const existing = await prisma.processedWebhook.findUnique(\n"}
[2026-01-31T22:37:58.930Z] INFO: [WebhookService] Webhook event logged {"eventId":"evt_test_activated","eventType":"membership.activated","success":false,"processed":false,"error":"\nInvalid `prisma.processedWebhook.findUnique()` invocation in\n/Users/timon/Downloads/lassttry-edge--main/server/webhook-service.ts:93:54\n\n  90 })\n  91 \n  92 // Check for already processed webhook (Idempotency)\nâ†’ 93 const existing = await prisma.processedWebhook.findUnique(\n"}

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Membership Events > should process membership.deactivated event
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Membership Events > should process membership.deactivated event
prisma:error 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:472:47

  469 })
  470 
  471 it('should process membership.deactivated event', async () => {
â†’ 472   const sub = await prisma.subscription.create(


stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Membership Events > should process membership.updated event
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Membership Events > should process membership.updated event
prisma:error 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:498:47

  495 })
  496 
  497 it('should process membership.updated event', async () => {
â†’ 498   const sub = await prisma.subscription.create(


stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Payment Events > should process payment.succeeded event
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Payment Events > should process payment.failed event
[2026-01-31T22:37:58.942Z] INFO: [WebhookService] Processing webhook event {"eventType":"payment.failed","eventId":"evt_test_payment_failed"}

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Payment Events > should process payment.failed event
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Payment Events > should process payment.failed event
prisma:error 
Invalid `prisma.processedWebhook.findUnique()` invocation in
/Users/timon/Downloads/lassttry-edge--main/server/webhook-service.ts:93:54

  90 })
  91 
  92 // Check for already processed webhook (Idempotency)
â†’ 93 const existing = await prisma.processedWebhook.findUnique(

[2026-01-31T22:37:58.946Z] ERROR: [WebhookService] Event processing failed {"eventType":"payment.failed","eventId":"evt_test_payment_failed","error":"\nInvalid `prisma.processedWebhook.findUnique()` invocation in\n/Users/timon/Downloads/lassttry-edge--main/server/webhook-service.ts:93:54\n\n  90 })\n  91 \n  92 // Check for already processed webhook (Idempotency)\nâ†’ 93 const existing = await prisma.processedWebhook.findUnique(\n"}
[2026-01-31T22:37:58.946Z] INFO: [WebhookService] Webhook event logged {"eventId":"evt_test_payment_failed","eventType":"payment.failed","success":false,"processed":false,"error":"\nInvalid `prisma.processedWebhook.findUnique()` invocation in\n/Users/timon/Downloads/lassttry-edge--main/server/webhook-service.ts:93:54\n\n  90 })\n  91 \n  92 // Check for already processed webhook (Idempotency)\nâ†’ 93 const existing = await prisma.processedWebhook.findUnique(\n"}

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Invoice Events > should process invoice.created event
[2026-01-31T22:37:58.947Z] INFO: [WebhookService] Processing webhook event {"eventType":"invoice.created","eventId":"evt_test_invoice_created"}

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Invoice Events > should process invoice.created event
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Invoice Events > should process invoice.created event
prisma:error 
Invalid `prisma.processedWebhook.findUnique()` invocation in
/Users/timon/Downloads/lassttry-edge--main/server/webhook-service.ts:93:54

  90 })
  91 
  92 // Check for already processed webhook (Idempotency)
â†’ 93 const existing = await prisma.processedWebhook.findUnique(

[2026-01-31T22:37:58.963Z] ERROR: [WebhookService] Event processing failed {"eventType":"invoice.created","eventId":"evt_test_invoice_created","error":"\nInvalid `prisma.processedWebhook.findUnique()` invocation in\n/Users/timon/Downloads/lassttry-edge--main/server/webhook-service.ts:93:54\n\n  90 })\n  91 \n  92 // Check for already processed webhook (Idempotency)\nâ†’ 93 const existing = await prisma.processedWebhook.findUnique(\n"}
[2026-01-31T22:37:58.963Z] INFO: [WebhookService] Webhook event logged {"eventId":"evt_test_invoice_created","eventType":"invoice.created","success":false,"processed":false,"error":"\nInvalid `prisma.processedWebhook.findUnique()` invocation in\n/Users/timon/Downloads/lassttry-edge--main/server/webhook-service.ts:93:54\n\n  90 })\n  91 \n  92 // Check for already processed webhook (Idempotency)\nâ†’ 93 const existing = await prisma.processedWebhook.findUnique(\n"}

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Invoice Events > should process invoice.paid event
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Invoice Events > should process invoice.paid event
prisma:error 
Invalid `prisma.invoice.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:591:46

  588 })
  589 
  590 it('should process invoice.paid event', async () => {
â†’ 591   const invoice = await prisma.invoice.create(


stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Security Manager Tests > Encryption/Decryption > should encrypt and decrypt text correctly
[2026-01-31T22:37:58.974Z] ERROR: [SecurityManager] Encryption failed {"error":{}}

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Security Manager Tests > Encryption/Decryption > should encrypt and decrypt text correctly
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > Security Manager Tests > Encryption/Decryption > should produce different encrypted values for same input
[2026-01-31T22:37:58.977Z] ERROR: [SecurityManager] Encryption failed {"error":{}}

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Security Manager Tests > Encryption/Decryption > should produce different encrypted values for same input
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Security Manager Tests > Input Validation > should validate valid email
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Security Manager Tests > Input Validation > should reject invalid email
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Security Manager Tests > Input Validation > should validate valid amount
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Security Manager Tests > Input Validation > should reject invalid amount
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Security Manager Tests > Data Masking > should mask card number correctly
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Security Manager Tests > Data Masking > should mask email correctly
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Security Manager Tests > Rate Limiting > should allow requests within limit
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Security Manager Tests > Rate Limiting > should block requests over limit
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Security Manager Tests > Suspicious Activity Detection > should detect suspicious activity with high score
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > Security Manager Tests > Suspicious Activity Detection > should not detect suspicious activity for normal data
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > End-to-End Payment Flow Tests > should complete full subscription lifecycle
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > End-to-End Payment Flow Tests > should complete full subscription lifecycle
[2026-01-31T22:37:59.236Z] ERROR: [PaymentService] Failed to create checkout session {"error":"401 {\"error\":{\"type\":\"unauthorized\",\"message\":\"Authentication failed\"}}","options":{"planKey":"monthly","userId":"e2e-test-user","email":"e2e@example.com"}}

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > End-to-End Payment Flow Tests > should handle payment failure and retry
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > End-to-End Payment Flow Tests > should handle payment failure and retry
prisma:error 
Invalid `prisma.subscription.findUnique()` invocation in
/Users/timon/Downloads/lassttry-edge--main/server/subscription-manager.ts:53:62

  50   metadata?: Record<string, any>
  51 }): Promise<{ success: boolean; subscriptionId?: string; error?: string }> {
  52   try {
â†’ 53     const existingSubscription = await prisma.subscription.findUnique(

[2026-01-31T22:37:59.240Z] ERROR: [SubscriptionManager] Failed to create subscription {"error":{"code":"ECONNREFUSED","meta":{"modelName":"Subscription"},"clientVersion":"7.3.0","name":"PrismaClientKnownRequestError"},"data":{"userId":"e2e-retry-user","email":"retry@example.com","plan":"monthly","interval":"month"}}

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > End-to-End Payment Flow Tests > should handle payment failure and retry
prisma:error 
Invalid `prisma.subscription.findUnique()` invocation in
/Users/timon/Downloads/lassttry-edge--main/server/subscription-manager.ts:276:54

  273   attemptNumber: number
  274 }): Promise<{ success: boolean; actionTaken?: string; error?: string }> {
  275   try {
â†’ 276     const subscription = await prisma.subscription.findUnique(

[2026-01-31T22:37:59.241Z] ERROR: [SubscriptionManager] Failed to handle payment failure {"error":{"code":"ECONNREFUSED","meta":{"modelName":"Subscription"},"clientVersion":"7.3.0","name":"PrismaClientKnownRequestError"},"data":{"userId":"e2e-retry-user","email":"retry@example.com","whopMembershipId":"membership_retry","attemptNumber":1}}

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > End-to-End Payment Flow Tests > should handle plan upgrade
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > End-to-End Payment Flow Tests > should handle plan upgrade
prisma:error 
Invalid `prisma.subscription.findUnique()` invocation in
/Users/timon/Downloads/lassttry-edge--main/server/subscription-manager.ts:53:62

  50   metadata?: Record<string, any>
  51 }): Promise<{ success: boolean; subscriptionId?: string; error?: string }> {
  52   try {
â†’ 53     const existingSubscription = await prisma.subscription.findUnique(

[2026-01-31T22:37:59.245Z] ERROR: [SubscriptionManager] Failed to create subscription {"error":{"code":"ECONNREFUSED","meta":{"modelName":"Subscription"},"clientVersion":"7.3.0","name":"PrismaClientKnownRequestError"},"data":{"userId":"e2e-upgrade-user","email":"upgrade@example.com","plan":"monthly","interval":"month"}}

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > End-to-End Payment Flow Tests > should handle plan upgrade
prisma:error 
Invalid `prisma.subscription.findUnique()` invocation in
/Users/timon/Downloads/lassttry-edge--main/server/subscription-manager.ts:127:54

  124   metadata?: Record<string, any>
  125 }): Promise<{ success: boolean; error?: string }> {
  126   try {
â†’ 127     const subscription = await prisma.subscription.findUnique(

[2026-01-31T22:37:59.246Z] ERROR: [SubscriptionManager] Failed to update subscription {"error":{"code":"ECONNREFUSED","meta":{"modelName":"Subscription"},"clientVersion":"7.3.0","name":"PrismaClientKnownRequestError"},"data":{"userId":"e2e-upgrade-user","plan":"yearly","interval":"year"}}

stderr | lib/__tests__/payment-flows.test.ts > Payment System Tests > End-to-End Payment Flow Tests > should handle refund flow
Could not truncate table PaymentTransaction: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Invoice: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Refund: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table SubscriptionEvent: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table PaymentMethod: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Promotion: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table UsageMetric: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
Could not truncate table Subscription: TypeError: Cannot read properties of undefined (reading '$executeRawUnsafe')
    at /Users/timon/Downloads/lassttry-edge--main/lib/__tests__/setup.ts:55:20
    at file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:146:14
    at runWithTimeout (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:39:7)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:964:28)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at callSuiteHook (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:953:16)
    at runTest (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1040:36)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/timon/Downloads/lassttry-edge--main/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | lib/__tests__/payment-flows.test.ts > Payment System Tests > End-to-End Payment Flow Tests > should handle refund flow
prisma:error 
Invalid `prisma.paymentTransaction.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:814:51

  811 const userId = 'e2e-refund-user'
  812 const email = 'refund@example.com'
  813 
â†’ 814 const txn = await prisma.paymentTransaction.create(


 â¯ lib/__tests__/payment-flows.test.ts (46 tests | 35 failed) 2552ms
   Ã— Payment System Tests > Payment Service Tests > Checkout Session Creation > should create a checkout session for monthly plan 994ms
     â†’ expected false to be true // Object.is equality
   Ã— Payment System Tests > Payment Service Tests > Checkout Session Creation > should create a checkout session with referral code 1009ms
     â†’ expected false to be true // Object.is equality
   Ã— Payment System Tests > Payment Service Tests > Promotion Code Validation > should validate a valid promotion code 123ms
     â†’ 
Invalid `prisma.promotion.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:51:32

  48 
  49 describe('Promotion Code Validation', () => {
  50   it('should validate a valid promotion code', async () => {
â†’ 51     await prisma.promotion.create(

   Ã— Payment System Tests > Payment Service Tests > Promotion Code Validation > should reject expired promotion code 8ms
     â†’ 
Invalid `prisma.promotion.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:72:32

  69 })
  70 
  71 it('should reject expired promotion code', async () => {
â†’ 72   await prisma.promotion.create(

   Ã— Payment System Tests > Payment Service Tests > Promotion Code Validation > should reject inactive promotion code 4ms
     â†’ 
Invalid `prisma.promotion.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:92:32

  89 })
  90 
  91 it('should reject inactive promotion code', async () => {
â†’ 92   await prisma.promotion.create(

   Ã— Payment System Tests > Payment Service Tests > Transaction Recording > should record a successful transaction 7ms
     â†’ expected false to be true // Object.is equality
   Ã— Payment System Tests > Payment Service Tests > Invoice Creation > should create an invoice 4ms
     â†’ expected false to be true // Object.is equality
   Ã— Payment System Tests > Payment Service Tests > Refund Processing > should process a full refund 3ms
     â†’ 
Invalid `prisma.paymentTransaction.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:163:53

  160 
  161 describe('Refund Processing', () => {
  162   it('should process a full refund', async () => {
â†’ 163     const txn = await prisma.paymentTransaction.create(

   Ã— Payment System Tests > Payment Service Tests > Refund Processing > should process a partial refund 6ms
     â†’ 
Invalid `prisma.paymentTransaction.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:186:53

  183 })
  184 
  185 it('should process a partial refund', async () => {
â†’ 186   const txn = await prisma.paymentTransaction.create(

   Ã— Payment System Tests > Payment Service Tests > Refund Processing > should fail to refund non-completed transaction 4ms
     â†’ 
Invalid `prisma.paymentTransaction.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:208:53

  205 })
  206 
  207 it('should fail to refund non-completed transaction', async () => {
â†’ 208   const txn = await prisma.paymentTransaction.create(

   Ã— Payment System Tests > Subscription Manager Tests > Subscription Creation > should create a monthly subscription 16ms
     â†’ expected false to be true // Object.is equality
   Ã— Payment System Tests > Subscription Manager Tests > Subscription Creation > should create a trial subscription 6ms
     â†’ expected false to be true // Object.is equality
   Ã— Payment System Tests > Subscription Manager Tests > Subscription Creation > should create a lifetime subscription 4ms
     â†’ expected false to be true // Object.is equality
   Ã— Payment System Tests > Subscription Manager Tests > Subscription Updates > should upgrade subscription plan 3ms
     â†’ 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:270:47

  267 
  268 describe('Subscription Updates', () => {
  269   it('should upgrade subscription plan', async () => {
â†’ 270     const sub = await prisma.subscription.create(

   Ã— Payment System Tests > Subscription Manager Tests > Subscription Updates > should downgrade subscription plan 3ms
     â†’ 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:291:47

  288 })
  289 
  290 it('should downgrade subscription plan', async () => {
â†’ 291   const sub = await prisma.subscription.create(

   Ã— Payment System Tests > Subscription Manager Tests > Subscription Cancellation > should cancel subscription immediately 3ms
     â†’ 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:314:47

  311 
  312 describe('Subscription Cancellation', () => {
  313   it('should cancel subscription immediately', async () => {
â†’ 314     const sub = await prisma.subscription.create(

   Ã— Payment System Tests > Subscription Manager Tests > Subscription Cancellation > should schedule subscription cancellation 3ms
     â†’ 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:335:47

  332 })
  333 
  334 it('should schedule subscription cancellation', async () => {
â†’ 335   const sub = await prisma.subscription.create(

   Ã— Payment System Tests > Subscription Manager Tests > Payment Failure Handling > should mark subscription as past due on first failure 3ms
     â†’ 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:358:47

  355 
  356 describe('Payment Failure Handling', () => {
  357   it('should mark subscription as past due on first failure', async () => {
â†’ 358     const sub = await prisma.subscription.create(

   Ã— Payment System Tests > Subscription Manager Tests > Payment Failure Handling > should cancel subscription after 3 failures 7ms
     â†’ 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:381:47

  378 })
  379 
  380 it('should cancel subscription after 3 failures', async () => {
â†’ 381   const sub = await prisma.subscription.create(

   Ã— Payment System Tests > Subscription Manager Tests > Payment Success Handling > should update subscription on successful payment 3ms
     â†’ 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:406:47

  403 
  404 describe('Payment Success Handling', () => {
  405   it('should update subscription on successful payment', async () => {
â†’ 406     const sub = await prisma.subscription.create(

   Ã— Payment System Tests > Subscription Manager Tests > Grace Period Management > should start grace period for expired subscriptions 3ms
     â†’ 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:432:35

  429 describe('Grace Period Management', () => {
  430   it('should start grace period for expired subscriptions', async () => {
  431     const pastDate = new Date(Date.now() - 24 * 60 * 60 * 1000)
â†’ 432     await prisma.subscription.create(

   Ã— Payment System Tests > Webhook Service Tests > Membership Events > should process membership.activated event 6ms
     â†’ expected false to be true // Object.is equality
   Ã— Payment System Tests > Webhook Service Tests > Membership Events > should process membership.deactivated event 4ms
     â†’ 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:472:47

  469 })
  470 
  471 it('should process membership.deactivated event', async () => {
â†’ 472   const sub = await prisma.subscription.create(

   Ã— Payment System Tests > Webhook Service Tests > Membership Events > should process membership.updated event 4ms
     â†’ 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:498:47

  495 })
  496 
  497 it('should process membership.updated event', async () => {
â†’ 498   const sub = await prisma.subscription.create(

   Ã— Payment System Tests > Webhook Service Tests > Payment Events > should process payment.succeeded event 2ms
     â†’ fetchMembership does not exist
   Ã— Payment System Tests > Webhook Service Tests > Payment Events > should process payment.failed event 5ms
     â†’ expected false to be true // Object.is equality
   Ã— Payment System Tests > Webhook Service Tests > Invoice Events > should process invoice.created event 18ms
     â†’ expected false to be true // Object.is equality
   Ã— Payment System Tests > Webhook Service Tests > Invoice Events > should process invoice.paid event 9ms
     â†’ 
Invalid `prisma.invoice.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:591:46

  588 })
  589 
  590 it('should process invoice.paid event', async () => {
â†’ 591   const invoice = await prisma.invoice.create(

   Ã— Payment System Tests > Security Manager Tests > Encryption/Decryption > should encrypt and decrypt text correctly 3ms
     â†’ Encryption failed
   Ã— Payment System Tests > Security Manager Tests > Encryption/Decryption > should produce different encrypted values for same input 2ms
     â†’ Encryption failed
   Ã— Payment System Tests > Security Manager Tests > Data Masking > should mask card number correctly 3ms
     â†’ expected '4242********4242' to be '4242************4242' // Object.is equality
   Ã— Payment System Tests > End-to-End Payment Flow Tests > should complete full subscription lifecycle 240ms
     â†’ expected false to be true // Object.is equality
   Ã— Payment System Tests > End-to-End Payment Flow Tests > should handle payment failure and retry 5ms
     â†’ expected undefined to be 'marked_past_due' // Object.is equality
   Ã— Payment System Tests > End-to-End Payment Flow Tests > should handle plan upgrade 5ms
     â†’ expected false to be true // Object.is equality
   Ã— Payment System Tests > End-to-End Payment Flow Tests > should handle refund flow 3ms
     â†’ 
Invalid `prisma.paymentTransaction.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:814:51

  811 const userId = 'e2e-refund-user'
  812 const email = 'refund@example.com'
  813 
â†’ 814 const txn = await prisma.paymentTransaction.create(


âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Failed Tests 35 âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Checkout Session Creation > should create a checkout session for monthly plan
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ lib/__tests__/payment-flows.test.ts:22:32
     20|         })
     21| 
     22|         expect(result.success).toBe(true)
       |                                ^
     23|         expect(result.checkoutUrl).toBeDefined()
     24|       })

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Checkout Session Creation > should create a checkout session with referral code
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ lib/__tests__/payment-flows.test.ts:34:32
     32|         })
     33| 
     34|         expect(result.success).toBe(true)
       |                                ^
     35|       })
     36| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Promotion Code Validation > should validate a valid promotion code
PrismaClientKnownRequestError: 
Invalid `prisma.promotion.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:51:32

  48 
  49 describe('Promotion Code Validation', () => {
  50   it('should validate a valid promotion code', async () => {
â†’ 51     await prisma.promotion.create(

 â¯ Vr.handleRequestError prisma/generated/prisma/runtime/client.js:69:8172
 â¯ Vr.handleAndLogRequestError prisma/generated/prisma/runtime/client.js:69:7467
 â¯ Vr.request prisma/generated/prisma/runtime/client.js:69:7174
 â¯ a prisma/generated/prisma/runtime/client.js:79:5816
 â¯ lib/__tests__/payment-flows.test.ts:51:9
     49|     describe('Promotion Code Validation', () => {
     50|       it('should validate a valid promotion code', async () => {
     51|         await prisma.promotion.create({
       |         ^
     52|           data: {
     53|             code: 'TEST20',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Promotion Code Validation > should reject expired promotion code
PrismaClientKnownRequestError: 
Invalid `prisma.promotion.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:72:32

  69 })
  70 
  71 it('should reject expired promotion code', async () => {
â†’ 72   await prisma.promotion.create(

 â¯ Vr.handleRequestError prisma/generated/prisma/runtime/client.js:69:8172
 â¯ Vr.handleAndLogRequestError prisma/generated/prisma/runtime/client.js:69:7467
 â¯ Vr.request prisma/generated/prisma/runtime/client.js:69:7174
 â¯ a prisma/generated/prisma/runtime/client.js:79:5816
 â¯ lib/__tests__/payment-flows.test.ts:72:9
     70| 
     71|       it('should reject expired promotion code', async () => {
     72|         await prisma.promotion.create({
       |         ^
     73|           data: {
     74|             code: 'EXPIRED',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Promotion Code Validation > should reject inactive promotion code
PrismaClientKnownRequestError: 
Invalid `prisma.promotion.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:92:32

  89 })
  90 
  91 it('should reject inactive promotion code', async () => {
â†’ 92   await prisma.promotion.create(

 â¯ Vr.handleRequestError prisma/generated/prisma/runtime/client.js:69:8172
 â¯ Vr.handleAndLogRequestError prisma/generated/prisma/runtime/client.js:69:7467
 â¯ Vr.request prisma/generated/prisma/runtime/client.js:69:7174
 â¯ a prisma/generated/prisma/runtime/client.js:79:5816
 â¯ lib/__tests__/payment-flows.test.ts:92:9
     90| 
     91|       it('should reject inactive promotion code', async () => {
     92|         await prisma.promotion.create({
       |         ^
     93|           data: {
     94|             code: 'INACTIVE',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Transaction Recording > should record a successful transaction
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ lib/__tests__/payment-flows.test.ts:123:32
    121|         })
    122| 
    123|         expect(result.success).toBe(true)
       |                                ^
    124|         expect(result.transactionId).toBeDefined()
    125|       })

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Invoice Creation > should create an invoice
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ lib/__tests__/payment-flows.test.ts:156:32
    154|         })
    155| 
    156|         expect(result.success).toBe(true)
       |                                ^
    157|         expect(result.invoiceId).toBeDefined()
    158|       })

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Refund Processing > should process a full refund
PrismaClientKnownRequestError: 
Invalid `prisma.paymentTransaction.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:163:53

  160 
  161 describe('Refund Processing', () => {
  162   it('should process a full refund', async () => {
â†’ 163     const txn = await prisma.paymentTransaction.create(

 â¯ Vr.handleRequestError prisma/generated/prisma/runtime/client.js:69:8172
 â¯ Vr.handleAndLogRequestError prisma/generated/prisma/runtime/client.js:69:7467
 â¯ Vr.request prisma/generated/prisma/runtime/client.js:69:7174
 â¯ a prisma/generated/prisma/runtime/client.js:79:5816
 â¯ lib/__tests__/payment-flows.test.ts:163:21
    161|     describe('Refund Processing', () => {
    162|       it('should process a full refund', async () => {
    163|         const txn = await prisma.paymentTransaction.create({
       |                     ^
    164|           data: {
    165|             userId: 'test-user',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Refund Processing > should process a partial refund
PrismaClientKnownRequestError: 
Invalid `prisma.paymentTransaction.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:186:53

  183 })
  184 
  185 it('should process a partial refund', async () => {
â†’ 186   const txn = await prisma.paymentTransaction.create(

 â¯ Vr.handleRequestError prisma/generated/prisma/runtime/client.js:69:8172
 â¯ Vr.handleAndLogRequestError prisma/generated/prisma/runtime/client.js:69:7467
 â¯ Vr.request prisma/generated/prisma/runtime/client.js:69:7174
 â¯ a prisma/generated/prisma/runtime/client.js:79:5816
 â¯ lib/__tests__/payment-flows.test.ts:186:21
    184| 
    185|       it('should process a partial refund', async () => {
    186|         const txn = await prisma.paymentTransaction.create({
       |                     ^
    187|           data: {
    188|             userId: 'test-user',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Payment Service Tests > Refund Processing > should fail to refund non-completed transaction
PrismaClientKnownRequestError: 
Invalid `prisma.paymentTransaction.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:208:53

  205 })
  206 
  207 it('should fail to refund non-completed transaction', async () => {
â†’ 208   const txn = await prisma.paymentTransaction.create(

 â¯ Vr.handleRequestError prisma/generated/prisma/runtime/client.js:69:8172
 â¯ Vr.handleAndLogRequestError prisma/generated/prisma/runtime/client.js:69:7467
 â¯ Vr.request prisma/generated/prisma/runtime/client.js:69:7174
 â¯ a prisma/generated/prisma/runtime/client.js:79:5816
 â¯ lib/__tests__/payment-flows.test.ts:208:21
    206| 
    207|       it('should fail to refund non-completed transaction', async () =â€¦
    208|         const txn = await prisma.paymentTransaction.create({
       |                     ^
    209|           data: {
    210|             userId: 'test-user',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[10/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Creation > should create a monthly subscription
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ lib/__tests__/payment-flows.test.ts:240:32
    238|         })
    239| 
    240|         expect(result.success).toBe(true)
       |                                ^
    241|         expect(result.subscriptionId).toBeDefined()
    242|       })

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[11/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Creation > should create a trial subscription
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ lib/__tests__/payment-flows.test.ts:253:32
    251|         })
    252| 
    253|         expect(result.success).toBe(true)
       |                                ^
    254|       })
    255| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[12/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Creation > should create a lifetime subscription
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ lib/__tests__/payment-flows.test.ts:264:32
    262|         })
    263| 
    264|         expect(result.success).toBe(true)
       |                                ^
    265|       })
    266|     })

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[13/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Updates > should upgrade subscription plan
PrismaClientKnownRequestError: 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:270:47

  267 
  268 describe('Subscription Updates', () => {
  269   it('should upgrade subscription plan', async () => {
â†’ 270     const sub = await prisma.subscription.create(

 â¯ Vr.handleRequestError prisma/generated/prisma/runtime/client.js:69:8172
 â¯ Vr.handleAndLogRequestError prisma/generated/prisma/runtime/client.js:69:7467
 â¯ Vr.request prisma/generated/prisma/runtime/client.js:69:7174
 â¯ a prisma/generated/prisma/runtime/client.js:79:5816
 â¯ lib/__tests__/payment-flows.test.ts:270:21
    268|     describe('Subscription Updates', () => {
    269|       it('should upgrade subscription plan', async () => {
    270|         const sub = await prisma.subscription.create({
       |                     ^
    271|           data: {
    272|             userId: 'test-user-upgrade',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[14/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Updates > should downgrade subscription plan
PrismaClientKnownRequestError: 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:291:47

  288 })
  289 
  290 it('should downgrade subscription plan', async () => {
â†’ 291   const sub = await prisma.subscription.create(

 â¯ Vr.handleRequestError prisma/generated/prisma/runtime/client.js:69:8172
 â¯ Vr.handleAndLogRequestError prisma/generated/prisma/runtime/client.js:69:7467
 â¯ Vr.request prisma/generated/prisma/runtime/client.js:69:7174
 â¯ a prisma/generated/prisma/runtime/client.js:79:5816
 â¯ lib/__tests__/payment-flows.test.ts:291:21
    289| 
    290|       it('should downgrade subscription plan', async () => {
    291|         const sub = await prisma.subscription.create({
       |                     ^
    292|           data: {
    293|             userId: 'test-user-downgrade',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[15/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Cancellation > should cancel subscription immediately
PrismaClientKnownRequestError: 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:314:47

  311 
  312 describe('Subscription Cancellation', () => {
  313   it('should cancel subscription immediately', async () => {
â†’ 314     const sub = await prisma.subscription.create(

 â¯ Vr.handleRequestError prisma/generated/prisma/runtime/client.js:69:8172
 â¯ Vr.handleAndLogRequestError prisma/generated/prisma/runtime/client.js:69:7467
 â¯ Vr.request prisma/generated/prisma/runtime/client.js:69:7174
 â¯ a prisma/generated/prisma/runtime/client.js:79:5816
 â¯ lib/__tests__/payment-flows.test.ts:314:21
    312|     describe('Subscription Cancellation', () => {
    313|       it('should cancel subscription immediately', async () => {
    314|         const sub = await prisma.subscription.create({
       |                     ^
    315|           data: {
    316|             userId: 'test-user-cancel-immediate',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[16/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Subscription Cancellation > should schedule subscription cancellation
PrismaClientKnownRequestError: 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:335:47

  332 })
  333 
  334 it('should schedule subscription cancellation', async () => {
â†’ 335   const sub = await prisma.subscription.create(

 â¯ Vr.handleRequestError prisma/generated/prisma/runtime/client.js:69:8172
 â¯ Vr.handleAndLogRequestError prisma/generated/prisma/runtime/client.js:69:7467
 â¯ Vr.request prisma/generated/prisma/runtime/client.js:69:7174
 â¯ a prisma/generated/prisma/runtime/client.js:79:5816
 â¯ lib/__tests__/payment-flows.test.ts:335:21
    333| 
    334|       it('should schedule subscription cancellation', async () => {
    335|         const sub = await prisma.subscription.create({
       |                     ^
    336|           data: {
    337|             userId: 'test-user-cancel-end',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[17/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Payment Failure Handling > should mark subscription as past due on first failure
PrismaClientKnownRequestError: 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:358:47

  355 
  356 describe('Payment Failure Handling', () => {
  357   it('should mark subscription as past due on first failure', async () => {
â†’ 358     const sub = await prisma.subscription.create(

 â¯ Vr.handleRequestError prisma/generated/prisma/runtime/client.js:69:8172
 â¯ Vr.handleAndLogRequestError prisma/generated/prisma/runtime/client.js:69:7467
 â¯ Vr.request prisma/generated/prisma/runtime/client.js:69:7174
 â¯ a prisma/generated/prisma/runtime/client.js:79:5816
 â¯ lib/__tests__/payment-flows.test.ts:358:21
    356|     describe('Payment Failure Handling', () => {
    357|       it('should mark subscription as past due on first failure', asynâ€¦
    358|         const sub = await prisma.subscription.create({
       |                     ^
    359|           data: {
    360|             userId: 'test-user-fail-1',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[18/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Payment Failure Handling > should cancel subscription after 3 failures
PrismaClientKnownRequestError: 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:381:47

  378 })
  379 
  380 it('should cancel subscription after 3 failures', async () => {
â†’ 381   const sub = await prisma.subscription.create(

 â¯ Vr.handleRequestError prisma/generated/prisma/runtime/client.js:69:8172
 â¯ Vr.handleAndLogRequestError prisma/generated/prisma/runtime/client.js:69:7467
 â¯ Vr.request prisma/generated/prisma/runtime/client.js:69:7174
 â¯ a prisma/generated/prisma/runtime/client.js:79:5816
 â¯ lib/__tests__/payment-flows.test.ts:381:21
    379| 
    380|       it('should cancel subscription after 3 failures', async () => {
    381|         const sub = await prisma.subscription.create({
       |                     ^
    382|           data: {
    383|             userId: 'test-user-fail-3',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[19/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Payment Success Handling > should update subscription on successful payment
PrismaClientKnownRequestError: 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:406:47

  403 
  404 describe('Payment Success Handling', () => {
  405   it('should update subscription on successful payment', async () => {
â†’ 406     const sub = await prisma.subscription.create(

 â¯ Vr.handleRequestError prisma/generated/prisma/runtime/client.js:69:8172
 â¯ Vr.handleAndLogRequestError prisma/generated/prisma/runtime/client.js:69:7467
 â¯ Vr.request prisma/generated/prisma/runtime/client.js:69:7174
 â¯ a prisma/generated/prisma/runtime/client.js:79:5816
 â¯ lib/__tests__/payment-flows.test.ts:406:21
    404|     describe('Payment Success Handling', () => {
    405|       it('should update subscription on successful payment', async () â€¦
    406|         const sub = await prisma.subscription.create({
       |                     ^
    407|           data: {
    408|             userId: 'test-user-success',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[20/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Subscription Manager Tests > Grace Period Management > should start grace period for expired subscriptions
PrismaClientKnownRequestError: 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:432:35

  429 describe('Grace Period Management', () => {
  430   it('should start grace period for expired subscriptions', async () => {
  431     const pastDate = new Date(Date.now() - 24 * 60 * 60 * 1000)
â†’ 432     await prisma.subscription.create(

 â¯ Vr.handleRequestError prisma/generated/prisma/runtime/client.js:69:8172
 â¯ Vr.handleAndLogRequestError prisma/generated/prisma/runtime/client.js:69:7467
 â¯ Vr.request prisma/generated/prisma/runtime/client.js:69:7174
 â¯ a prisma/generated/prisma/runtime/client.js:79:5816
 â¯ lib/__tests__/payment-flows.test.ts:432:9
    430|       it('should start grace period for expired subscriptions', async â€¦
    431|         const pastDate = new Date(Date.now() - 24 * 60 * 60 * 1000)
    432|         await prisma.subscription.create({
       |         ^
    433|           data: {
    434|             userId: 'test-user-grace',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[21/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Membership Events > should process membership.activated event
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ lib/__tests__/payment-flows.test.ts:467:32
    465|         const result = await webhookService.processWebhook(event)
    466| 
    467|         expect(result.success).toBe(true)
       |                                ^
    468|         expect(result.processed).toBe(true)
    469|       })

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Membership Events > should process membership.deactivated event
PrismaClientKnownRequestError: 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:472:47

  469 })
  470 
  471 it('should process membership.deactivated event', async () => {
â†’ 472   const sub = await prisma.subscription.create(

 â¯ Vr.handleRequestError prisma/generated/prisma/runtime/client.js:69:8172
 â¯ Vr.handleAndLogRequestError prisma/generated/prisma/runtime/client.js:69:7467
 â¯ Vr.request prisma/generated/prisma/runtime/client.js:69:7174
 â¯ a prisma/generated/prisma/runtime/client.js:79:5816
 â¯ lib/__tests__/payment-flows.test.ts:472:21
    470| 
    471|       it('should process membership.deactivated event', async () => {
    472|         const sub = await prisma.subscription.create({
       |                     ^
    473|           data: {
    474|             userId: 'user_webhook_deactivate',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[23/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Membership Events > should process membership.updated event
PrismaClientKnownRequestError: 
Invalid `prisma.subscription.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:498:47

  495 })
  496 
  497 it('should process membership.updated event', async () => {
â†’ 498   const sub = await prisma.subscription.create(

 â¯ Vr.handleRequestError prisma/generated/prisma/runtime/client.js:69:8172
 â¯ Vr.handleAndLogRequestError prisma/generated/prisma/runtime/client.js:69:7467
 â¯ Vr.request prisma/generated/prisma/runtime/client.js:69:7174
 â¯ a prisma/generated/prisma/runtime/client.js:79:5816
 â¯ lib/__tests__/payment-flows.test.ts:498:21
    496| 
    497|       it('should process membership.updated event', async () => {
    498|         const sub = await prisma.subscription.create({
       |                     ^
    499|           data: {
    500|             userId: 'user_webhook_update',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[24/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Payment Events > should process payment.succeeded event
Error: fetchMembership does not exist
 â¯ lib/__tests__/payment-flows.test.ts:541:12
    539|         }
    540| 
    541|         vi.spyOn(webhookService as any, 'fetchMembership').mockResolveâ€¦
       |            ^
    542|           user: { email: 'payment@example.com', id: 'user_payment' },
    543|           metadata: { user_id: 'user_payment', plan: 'monthly' },

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[25/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Payment Events > should process payment.failed event
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ lib/__tests__/payment-flows.test.ts:565:32
    563|         const result = await webhookService.processWebhook(event)
    564| 
    565|         expect(result.success).toBe(true)
       |                                ^
    566|       })
    567|     })

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[26/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Invoice Events > should process invoice.created event
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ lib/__tests__/payment-flows.test.ts:587:32
    585|         const result = await webhookService.processWebhook(event)
    586| 
    587|         expect(result.success).toBe(true)
       |                                ^
    588|       })
    589| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[27/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Webhook Service Tests > Invoice Events > should process invoice.paid event
PrismaClientKnownRequestError: 
Invalid `prisma.invoice.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:591:46

  588 })
  589 
  590 it('should process invoice.paid event', async () => {
â†’ 591   const invoice = await prisma.invoice.create(

 â¯ Vr.handleRequestError prisma/generated/prisma/runtime/client.js:69:8172
 â¯ Vr.handleAndLogRequestError prisma/generated/prisma/runtime/client.js:69:7467
 â¯ Vr.request prisma/generated/prisma/runtime/client.js:69:7174
 â¯ a prisma/generated/prisma/runtime/client.js:79:5816
 â¯ lib/__tests__/payment-flows.test.ts:591:25
    589| 
    590|       it('should process invoice.paid event', async () => {
    591|         const invoice = await prisma.invoice.create({
       |                         ^
    592|           data: {
    593|             userId: 'user_invoice_paid',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[28/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Security Manager Tests > Encryption/Decryption > should encrypt and decrypt text correctly
Error: Encryption failed
 â¯ SecurityManager.encrypt server/payment-security.ts:74:13
     72|     } catch (error) {
     73|       logger.error('[SecurityManager] Encryption failed', { error })
     74|       throw new Error('Encryption failed')
       |             ^
     75|     }
     76|   }
 â¯ lib/__tests__/payment-flows.test.ts:624:43

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[29/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Security Manager Tests > Encryption/Decryption > should produce different encrypted values for same input
Error: Encryption failed
 â¯ SecurityManager.encrypt server/payment-security.ts:74:13
     72|     } catch (error) {
     73|       logger.error('[SecurityManager] Encryption failed', { error })
     74|       throw new Error('Encryption failed')
       |             ^
     75|     }
     76|   }
 â¯ lib/__tests__/payment-flows.test.ts:632:44

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[30/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > Security Manager Tests > Data Masking > should mask card number correctly
AssertionError: expected '4242********4242' to be '4242************4242' // Object.is equality

Expected: "4242************4242"
Received: "4242********4242"

 â¯ lib/__tests__/payment-flows.test.ts:666:24
    664|         const masked = securityManager.maskCardNumber(cardNumber)
    665| 
    666|         expect(masked).toBe('4242************4242')
       |                        ^
    667|       })
    668| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[31/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > End-to-End Payment Flow Tests > should complete full subscription lifecycle
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ lib/__tests__/payment-flows.test.ts:728:38
    726|         email,
    727|       })
    728|       expect(checkoutResult.success).toBe(true)
       |                                      ^
    729| 
    730|       const subResult = await subscriptionManager.createSubscription({

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[32/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > End-to-End Payment Flow Tests > should handle payment failure and retry
AssertionError: expected undefined to be 'marked_past_due' // Object.is equality

- Expected: 
"marked_past_due"

+ Received: 
undefined

 â¯ lib/__tests__/payment-flows.test.ts:772:39
    770|         attemptNumber: 1,
    771|       })
    772|       expect(fail1Result.actionTaken).toBe('marked_past_due')
       |                                       ^
    773| 
    774|       const fail2Result = await subscriptionManager.handlePaymentFailuâ€¦

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[33/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > End-to-End Payment Flow Tests > should handle plan upgrade
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ lib/__tests__/payment-flows.test.ts:807:37
    805|         interval: 'year',
    806|       })
    807|       expect(upgradeResult.success).toBe(true)
       |                                     ^
    808|     })
    809| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[34/35]âŽ¯

 FAIL  lib/__tests__/payment-flows.test.ts > Payment System Tests > End-to-End Payment Flow Tests > should handle refund flow
PrismaClientKnownRequestError: 
Invalid `prisma.paymentTransaction.create()` invocation in
/Users/timon/Downloads/lassttry-edge--main/lib/__tests__/payment-flows.test.ts:814:51

  811 const userId = 'e2e-refund-user'
  812 const email = 'refund@example.com'
  813 
â†’ 814 const txn = await prisma.paymentTransaction.create(

 â¯ Vr.handleRequestError prisma/generated/prisma/runtime/client.js:69:8172
 â¯ Vr.handleAndLogRequestError prisma/generated/prisma/runtime/client.js:69:7467
 â¯ Vr.request prisma/generated/prisma/runtime/client.js:69:7174
 â¯ a prisma/generated/prisma/runtime/client.js:79:5816
 â¯ lib/__tests__/payment-flows.test.ts:814:19
    812|       const email = 'refund@example.com'
    813| 
    814|       const txn = await prisma.paymentTransaction.create({
       |                   ^
    815|         data: {
    816|           userId,

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[35/35]âŽ¯

 Test Files  1 failed (1)
      Tests  35 failed | 11 passed (46)
   Start at  04:07:55
   Duration  3.72s (transform 187ms, setup 139ms, collect 235ms, tests 2.55s, environment 0ms, prepare 294ms)

